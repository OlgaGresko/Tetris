!function(){function e(e){return e&&e.__esModule?e.default:e}var t={};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};var i={};function s(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(e,t,i){t&&s(e.prototype,t);i&&s(e,i);return e};var n={};Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i;return e};var l=function(){"use strict";function s(){e(t)(this,s),this.reset()}return e(i)(s,[{key:"level",get:function(){return Math.floor(.1*this.lines)}},{key:"getState",value:function(){for(var e=this.createPlayfield(),t=this.activePiece,i=t.y,s=t.x,n=t.blocks,l=0;l<this.playfield.length;l++){e[l]=[];for(var h=0;h<this.playfield[l].length;h++)e[l][h]=this.playfield[l][h]}for(var a=0;a<n.length;a++)for(var r=0;r<n[a].length;r++)n[a][r]&&(e[i+a][s+r]=n[a][r]);return{score:this.score,level:this.level,lines:this.lines,nextPiece:this.nextPiece,playfield:e,isGameOver:this.topOut}}},{key:"reset",value:function(){this.score=0,this.lines=0,this.topOut=!1,this.playfield=this.createPlayfield(),this.activePiece=this.createPiece(),this.nextPiece=this.createPiece()}},{key:"createPlayfield",value:function(){for(var e=[],t=0;t<20;t++){e[t]=[];for(var i=0;i<10;i++)e[t][i]=0}return e}},{key:"createPiece",value:function(){var e={};switch("IJLOSTZ"[Math.floor(7*Math.random())]){case"I":e.blocks=[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]];break;case"J":e.blocks=[[0,0,0],[2,2,2],[0,0,2]];break;case"L":e.blocks=[[0,0,0],[3,3,3],[3,0,0]];break;case"O":e.blocks=[[0,0,0,0],[0,4,4,0],[0,4,4,0],[0,0,0,0]];break;case"S":e.blocks=[[0,0,0],[0,5,5],[5,5,0]];break;case"T":e.blocks=[[0,0,0],[6,6,6],[0,6,0]];break;case"Z":e.blocks=[[0,0,0],[7,7,0],[0,7,7]];break;default:throw new Error("Unknown type of figure")}return e.x=Math.floor((10-e.blocks[0].length)/2),e.y=-1,e}},{key:"movePieceLeft",value:function(){this.activePiece.x-=1,this.hasCollision()&&(this.activePiece.x+=1)}},{key:"movePieceRight",value:function(){this.activePiece.x+=1,this.hasCollision()&&(this.activePiece.x-=1)}},{key:"movePieceDown",value:function(){if(!this.topOut){if(this.activePiece.y+=1,this.hasCollision()){this.activePiece.y-=1,this.lockPiece();var e=this.clearLines();this.updateScore(e),this.updatePieces()}this.hasCollision()&&(this.topOut=!0)}}},{key:"rotatePiece",value:function(){this.rotateBlocks(),this.hasCollision()&&this.rotateBlocks(!1)}},{key:"rotateBlocks",value:function(){for(var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.activePiece.blocks,i=t.length,s=Math.floor(i/2),n=i-1,l=0;l<s;l++)for(var h=l;h<n-l;h++){var a=t[l][h];e?(t[l][h]=t[n-h][l],t[n-h][l]=t[n-l][n-h],t[n-l][n-h]=t[h][n-l],t[h][n-l]=a):(t[l][h]=t[h][n-l],t[h][n-l]=t[n-l][n-h],t[n-l][n-h]=t[n-h][l],t[n-h][l]=a)}}},{key:"hasCollision",value:function(){for(var e=this.activePiece,t=e.y,i=e.x,s=e.blocks,n=0;n<s.length;n++)for(var l=0;l<s.length;l++)if(s[n][l]&&(void 0===this.playfield[t+n]||void 0===this.playfield[t+n][i+l]||this.playfield[t+n][i+l]))return!0;return!1}},{key:"lockPiece",value:function(){for(var e=this.activePiece,t=e.y,i=e.x,s=e.blocks,n=0;n<s.length;n++)for(var l=0;l<s.length;l++)s[n][l]&&(this.playfield[t+n][i+l]=s[n][l])}},{key:"clearLines",value:function(){for(var e=[],t=19;t>0;t--){for(var i=0,s=0;s<10;s++)this.playfield[t][s]&&(i+=1);if(0===i)break;i<10||10===i&&e.unshift(t)}var n=!0,l=!1,h=void 0;try{for(var a,r=e[Symbol.iterator]();!(n=(a=r.next()).done);n=!0){var o=a.value;this.playfield.splice(o,1),this.playfield.unshift(new Array(10).fill(0))}}catch(e){l=!0,h=e}finally{try{n||null==r.return||r.return()}finally{if(l)throw h}}return e.length}},{key:"updateScore",value:function(e){e>0&&(this.score+=s.points[e]*(this.level+1),this.lines+=e)}},{key:"updatePieces",value:function(){this.activePiece=this.nextPiece,this.nextPiece=this.createPiece()}}]),s}();e(n)(l,"points",{1:40,2:100,3:300,4:1200});var h=function(){"use strict";function s(i,n,l,h,a){e(t)(this,s),this.element=i,this.width=n,this.height=l,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.context=this.canvas.getContext("2d"),this.playfieldBorderWidth=4,this.playfieldX=this.playfieldBorderWidth,this.playfieldY=this.playfieldBorderWidth,this.playfieldWidth=2*this.width/3,this.playfieldHeight=this.height,this.playfieldInnerWidth=this.playfieldWidth-2*this.playfieldBorderWidth,this.playfieldInnerHeight=this.playfieldHeight-2*this.playfieldBorderWidth,this.blockWidth=this.playfieldInnerWidth/a,this.blockHeight=this.playfieldInnerHeight/h,this.panelX=this.playfieldWidth+10,this.panelY=0,this.panelWidth=this.width/3,this.panelHeight=this.height,this.element.appendChild(this.canvas)}return e(i)(s,[{key:"renderMainScreen",value:function(e){this.clearScreen(),this.renderPlayfield(e),this.renderPanel(e)}},{key:"renderStartScreen",value:function(){this.context.fillStyle="white",this.context.font='18px "Press Start 2P"',this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillText("Press ENTER to Start",this.width/2,this.height/2)}},{key:"renderPauseScreen",value:function(){this.context.fillStyle="rgba(0,0,0,0.75)",this.context.fillRect(0,0,this.width,this.height),this.context.fillStyle="white",this.context.font='18px "Press Start 2P"',this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillText("Press ENTER to Resume",this.width/2,this.height/2)}},{key:"renderEndScreen",value:function(e){var t=e.score;this.clearScreen(),this.context.fillStyle="white",this.context.font='18px "Press Start 2P"',this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillText("GAME OVER",this.width/2,this.height/2-48),this.context.fillText("Score: ".concat(t),this.width/2,this.height/2),this.context.fillText("Press ENTER to Restart",this.width/2,this.height/2+48)}},{key:"clearScreen",value:function(){this.context.clearRect(0,0,this.width,this.height)}},{key:"renderPlayfield",value:function(e){for(var t=e.playfield,i=0;i<t.length;i++)for(var n=t[i],l=0;l<n.length;l++){var h=n[l];h&&this.renderBlock(this.playfieldX+l*this.blockWidth,this.playfieldY+i*this.blockHeight,this.blockWidth,this.blockHeight,s.colors[h])}this.context.strokeStyle="white",this.context.lineWidth=this.playfieldBorderWidth,this.context.strokeRect(0,0,this.playfieldWidth,this.playfieldHeight)}},{key:"renderPanel",value:function(e){var t=e.level,i=e.score,n=e.lines,l=e.nextPiece;this.context.textAlign="start",this.context.textBaseline="top",this.context.fillStyle="white",this.context.font='14px "Press Start 2P"',this.context.fillText("Score: ".concat(i),this.panelX,this.panelY+0),this.context.fillText("Lines: ".concat(n),this.panelX,this.panelY+24),this.context.fillText("Level: ".concat(t),this.panelX,this.panelY+48),this.context.fillText("Next:",this.panelX,this.panelY+96);for(var h=0;h<l.blocks.length;h++)for(var a=0;a<l.blocks[h].length;a++){var r=l.blocks[h][a];r&&this.renderBlock(this.panelX+a*this.blockWidth*.5,this.panelY+100+h*this.blockHeight*.5,.5*this.blockWidth,.5*this.blockHeight,s.colors[r])}}},{key:"renderBlock",value:function(e,t,i,s,n){this.context.fillStyle=n,this.context.strokeStyle="black",this.context.lineWidth=2,this.context.fillRect(e,t,i,s),this.context.strokeRect(e,t,i,s)}}]),s}();e(n)(h,"colors",{1:"cyan",2:"blue",3:"orange",4:"yellow",5:"green",6:"purple",7:"red"});var a=function(){"use strict";function s(i,n){e(t)(this,s),this.game=i,this.view=n,this.intervalId=null,this.isPlaying=!1,document.addEventListener("keydown",this.handleKeyDown.bind(this)),document.addEventListener("keyup",this.handleKeyUp.bind(this)),this.view.renderStartScreen()}return e(i)(s,[{key:"update",value:function(){this.game.movePieceDown(),this.updateView()}},{key:"play",value:function(){this.isPlaying=!0,this.startTimer(),this.updateView()}},{key:"pause",value:function(){this.isPlaying=!1,this.stopTimer(),this.updateView()}},{key:"reset",value:function(){this.game.reset(),this.stopTimer(),this.play()}},{key:"updateView",value:function(){var e=this.game.getState();e.isGameOver?this.view.renderEndScreen(e):this.isPlaying?this.view.renderMainScreen(this.game.getState()):this.view.renderPauseScreen()}},{key:"startTimer",value:function(){var e=this,t=1e3-100*this.game.getState().level;this.intervalId||(this.intervalId=setInterval((function(){e.update()}),t>0?t:100))}},{key:"stopTimer",value:function(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}},{key:"handleKeyDown",value:function(e){var t=this.game.getState();switch(e.key){case"Enter":t.isGameOver?this.reset():this.isPlaying?this.pause():this.play();break;case"ArrowLeft":this.isPlaying&&(this.game.movePieceLeft(),this.updateView());break;case"ArrowUp":this.isPlaying&&(this.game.rotatePiece(),this.updateView());break;case"ArrowRight":this.isPlaying&&(this.game.movePieceRight(),this.updateView());break;case"ArrowDown":this.isPlaying&&(this.stopTimer(),this.game.movePieceDown(),this.updateView())}}},{key:"handleKeyUp",value:function(e){if("ArrowDown"===e.key)this.startTimer()}}]),s}(),r=document.querySelector("#root"),o=new l,c=new h(r,480,640,20,10),d=new a(o,c);window.game=o,window.view=c,window.controller=d}();
//# sourceMappingURL=index.7e54e349.js.map
