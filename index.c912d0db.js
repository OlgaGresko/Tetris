function e(e){return e&&e.__esModule?e.default:e}var t={};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i;return e};class i{get level(){return Math.floor(.1*this.lines)}getState(){const e=this.createPlayfield(),{y:t,x:i,blocks:l}=this.activePiece;for(let t=0;t<this.playfield.length;t++){e[t]=[];for(let i=0;i<this.playfield[t].length;i++)e[t][i]=this.playfield[t][i]}for(let s=0;s<l.length;s++)for(let h=0;h<l[s].length;h++)l[s][h]&&(e[t+s][i+h]=l[s][h]);return{score:this.score,level:this.level,lines:this.lines,nextPiece:this.nextPiece,playfield:e}}createPlayfield(){const e=[];for(let t=0;t<20;t++){e[t]=[];for(let i=0;i<10;i++)e[t][i]=0}return e}createPiece(){const e={};switch("IJLOSTZ"[Math.floor(7*Math.random())]){case"I":e.blocks=[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]];break;case"J":e.blocks=[[0,0,0],[2,2,2],[0,0,2]];break;case"L":e.blocks=[[0,0,0],[3,3,3],[3,0,0]];break;case"O":e.blocks=[[0,0,0,0],[0,4,4,0],[0,4,4,0],[0,0,0,0]];break;case"S":e.blocks=[[0,0,0],[0,5,5],[5,5,0]];break;case"T":e.blocks=[[0,0,0],[6,6,6],[0,6,0]];break;case"Z":e.blocks=[[0,0,0],[7,7,0],[0,7,7]];break;default:throw new Error("Unknown type of figure")}return e.x=Math.floor((10-e.blocks[0].length)/2),e.y=0,e}movePieceLeft(){this.activePiece.x-=1,this.hasCollision()&&(this.activePiece.x+=1)}movePieceRight(){this.activePiece.x+=1,this.hasCollision()&&(this.activePiece.x-=1)}movePieceDown(){if(this.activePiece.y+=1,this.hasCollision()){this.activePiece.y-=1,this.lockPiece();const e=this.clearLines();this.updateScore(e),this.updatePieces()}}rotatePiece(){this.rotateBlocks(),this.hasCollision()&&this.rotateBlocks(!1)}rotateBlocks(e=!0){const t=this.activePiece.blocks,i=t.length,l=Math.floor(i/2),s=i-1;for(let i=0;i<l;i++)for(let l=i;l<s-i;l++){const h=t[i][l];e?(t[i][l]=t[s-l][i],t[s-l][i]=t[s-i][s-l],t[s-i][s-l]=t[l][s-i],t[l][s-i]=h):(t[i][l]=t[l][s-i],t[l][s-i]=t[s-i][s-l],t[s-i][s-l]=t[s-l][i],t[s-l][i]=h)}}hasCollision(){const{y:e,x:t,blocks:i}=this.activePiece;for(let l=0;l<i.length;l++)for(let s=0;s<i.length;s++)if(i[l][s]&&(void 0===this.playfield[e+l]||void 0===this.playfield[e+l][t+s]||this.playfield[e+l][t+s]))return!0;return!1}lockPiece(){const{y:e,x:t,blocks:i}=this.activePiece;for(let l=0;l<i.length;l++)for(let s=0;s<i.length;s++)i[l][s]&&(this.playfield[e+l][t+s]=i[l][s])}clearLines(){let e=[];for(let t=19;t>0;t--){let i=0;for(let e=0;e<10;e++)this.playfield[t][e]&&(i+=1);if(0===i)break;i<10||10===i&&e.unshift(t)}for(let t of e)this.playfield.splice(t,1),this.playfield.unshift(new Array(10).fill(0));return e.length}updateScore(e){e>0&&(this.score+=i.points[e]*(this.level+1),this.lines+=e)}updatePieces(){this.activePiece=this.nextPiece,this.nextPiece=this.createPiece()}constructor(){e(t)(this,"score",0),e(t)(this,"lines",0),e(t)(this,"playfield",this.createPlayfield()),e(t)(this,"activePiece",this.createPiece()),e(t)(this,"nextPiece",this.createPiece())}}e(t)(i,"points",{1:40,2:100,3:300,4:1200});class l{renderMainScreen(e){this.clearScreen(),this.renderPlayfield(e),this.renderPanel(e)}renderStartScreen(){this.context.fillStyle="white",this.context.font='18px "Press Start 2P"',this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillText("Press ENTER to Start",this.width/2,this.height/2)}renderPauseScreen(){this.context.fillStyle="rgba(0,0,0,0.75)",this.context.fillRect(0,0,this.width,this.height),this.context.fillStyle="white",this.context.font='18px "Press Start 2P"',this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillText("Press ENTER to Resume",this.width/2,this.height/2)}renderEndScreen({score:e}){this.clearScreen(),this.context.fillStyle="white",this.context.font='18px "Press Start 2P"',this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillText("GAME OVER",this.width/2,this.height/2-48),this.context.fillText(`Score: ${e}`,this.width/2,this.height/2)}clearScreen(){this.context.clearRect(0,0,this.width,this.height)}renderPlayfield({playfield:e}){for(let t=0;t<e.length;t++){const i=e[t];for(let e=0;e<i.length;e++){const s=i[e];s&&this.renderBlock(this.playfieldX+e*this.blockWidth,this.playfieldY+t*this.blockHeight,this.blockWidth,this.blockHeight,l.colors[s])}}this.context.strokeStyle="white",this.context.lineWidth=this.playfieldBorderWidth,this.context.strokeRect(0,0,this.playfieldWidth,this.playfieldHeight)}renderPanel({level:e,score:t,lines:i,nextPiece:s}){this.context.textAlign="start",this.context.textBaseline="top",this.context.fillStyle="white",this.context.font='14px "Press Start 2P"',this.context.fillText(`Score: ${t}`,this.panelX,this.panelY+0),this.context.fillText(`Lines: ${i}`,this.panelX,this.panelY+24),this.context.fillText(`Level: ${e}`,this.panelX,this.panelY+48),this.context.fillText("Next:",this.panelX,this.panelY+96);for(let e=0;e<s.blocks.length;e++)for(let t=0;t<s.blocks[e].length;t++){const i=s.blocks[e][t];i&&this.renderBlock(this.panelX+t*this.blockWidth*.5,this.panelY+100+e*this.blockHeight*.5,.5*this.blockWidth,.5*this.blockHeight,l.colors[i])}}renderBlock(e,t,i,l,s){this.context.fillStyle=s,this.context.strokeStyle="black",this.context.lineWidth=2,this.context.fillRect(e,t,i,l),this.context.strokeRect(e,t,i,l)}constructor(e,t,i,l,s){this.element=e,this.width=t,this.height=i,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.context=this.canvas.getContext("2d"),this.playfieldBorderWidth=4,this.playfieldX=this.playfieldBorderWidth,this.playfieldY=this.playfieldBorderWidth,this.playfieldWidth=2*this.width/3,this.playfieldHeight=this.height,this.playfieldInnerWidth=this.playfieldWidth-2*this.playfieldBorderWidth,this.playfieldInnerHeight=this.playfieldHeight-2*this.playfieldBorderWidth,this.blockWidth=this.playfieldInnerWidth/s,this.blockHeight=this.playfieldInnerHeight/l,this.panelX=this.playfieldWidth+10,this.panelY=0,this.panelWidth=this.width/3,this.panelHeight=this.height,this.element.appendChild(this.canvas)}}e(t)(l,"colors",{1:"cyan",2:"blue",3:"orange",4:"yellow",5:"green",6:"purple",7:"red"});const s=document.querySelector("#root"),h=new i,c=new l(s,480,640,20,10);window.game=h,window.view=c,document.addEventListener("keydown",(e=>{switch(e.keyCode){case 37:h.movePieceLeft(),c.render(h.getState());break;case 38:h.rotatePiece(),c.render(h.getState());break;case 39:h.movePieceRight(),c.render(h.getState());break;case 40:h.movePieceDown(),c.render(h.getState())}}));
//# sourceMappingURL=index.c912d0db.js.map
