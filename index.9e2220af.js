!function(){function e(e){return e&&e.__esModule?e.default:e}var t={};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};var i={};function a(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(e,t,i){t&&a(e.prototype,t);i&&a(e,i);return e};var r={};Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i;return e};var n=function(){"use strict";function a(){e(t)(this,a),e(r)(this,"score",0),e(r)(this,"lines",19),e(r)(this,"playfield",this.createPlayfield()),e(r)(this,"activePiece",this.createPiece()),e(r)(this,"nextPiece",this.createPiece())}return e(i)(a,[{key:"level",get:function(){return Math.floor(.1*this.lines)}},{key:"getState",value:function(){for(var e=this.createPlayfield(),t=this.activePiece,i=t.y,a=t.x,r=t.blocks,n=0;n<this.playfield.length;n++){e[n]=[];for(var l=0;l<this.playfield[n].length;l++)e[n][l]=this.playfield[n][l]}for(var c=0;c<r.length;c++)for(var o=0;o<r[c].length;o++)r[c][o]&&(e[i+c][a+o]=r[c][o]);return{playfield:e}}},{key:"createPlayfield",value:function(){for(var e=[],t=0;t<20;t++){e[t]=[];for(var i=0;i<10;i++)e[t][i]=0}return e}},{key:"createPiece",value:function(){var e={};switch("IJLOSTZ"[Math.floor(7*Math.random())]){case"I":e.blocks=[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]];break;case"J":e.blocks=[[0,0,0],[2,2,2],[0,0,2]];break;case"L":e.blocks=[[0,0,0],[3,3,3],[3,0,0]];break;case"O":e.blocks=[[0,0,0,0],[0,4,4,0],[0,4,4,0],[0,0,0,0]];break;case"S":e.blocks=[[0,0,0],[0,5,5],[5,5,0]];break;case"T":e.blocks=[[0,0,0],[6,6,6],[0,6,0]];break;case"Z":e.blocks=[[0,0,0],[7,7,0],[0,7,7]];break;default:throw new Error("Unknown type of figure")}return e.x=Math.floor((10-e.blocks[0].length)/2),e.y=0,e}},{key:"movePieceLeft",value:function(){this.activePiece.x-=1,this.hasCollision()&&(this.activePiece.x+=1)}},{key:"movePieceRight",value:function(){this.activePiece.x+=1,this.hasCollision()&&(this.activePiece.x-=1)}},{key:"movePieceDown",value:function(){if(this.activePiece.y+=1,this.hasCollision()){this.activePiece.y-=1,this.lockPiece();var e=this.clearLines();this.updateScore(e),this.updatePieces()}}},{key:"rotatePiece",value:function(){this.rotateBlocks(),this.hasCollision()&&this.rotateBlocks(!1)}},{key:"rotateBlocks",value:function(){for(var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.activePiece.blocks,i=t.length,a=Math.floor(i/2),r=i-1,n=0;n<a;n++)for(var l=n;l<r-n;l++){var c=t[n][l];e?(t[n][l]=t[r-l][n],t[r-l][n]=t[r-n][r-l],t[r-n][r-l]=t[l][r-n],t[l][r-n]=c):(t[n][l]=t[l][r-n],t[l][r-n]=t[r-n][r-l],t[r-n][r-l]=t[r-l][n],t[r-l][n]=c)}}},{key:"hasCollision",value:function(){for(var e=this.activePiece,t=e.y,i=e.x,a=e.blocks,r=0;r<a.length;r++)for(var n=0;n<a.length;n++)if(a[r][n]&&(void 0===this.playfield[t+r]||void 0===this.playfield[t+r][i+n]||this.playfield[t+r][i+n]))return!0;return!1}},{key:"lockPiece",value:function(){for(var e=this.activePiece,t=e.y,i=e.x,a=e.blocks,r=0;r<a.length;r++)for(var n=0;n<a.length;n++)a[r][n]&&(this.playfield[t+r][i+n]=a[r][n])}},{key:"clearLines",value:function(){for(var e=[],t=19;t>0;t--){for(var i=0,a=0;a<10;a++)this.playfield[t][a]&&(i+=1);if(0===i)break;i<10||10===i&&e.unshift(t)}var r=!0,n=!1,l=void 0;try{for(var c,o=e[Symbol.iterator]();!(r=(c=o.next()).done);r=!0){var s=c.value;this.playfield.splice(s,1),this.playfield.unshift(new Array(10).fill(0))}}catch(e){n=!0,l=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw l}}return e.length}},{key:"updateScore",value:function(e){e>0&&(this.score+=a.points[e]*(this.level+1),this.lines+=e)}},{key:"updatePieces",value:function(){this.activePiece=this.nextPiece,this.nextPiece=this.createPiece()}}]),a}();e(r)(n,"points",{1:40,2:100,3:300,4:1200});var l=function(){"use strict";function a(i,r,n,l,c){e(t)(this,a),this.element=i,this.width=r,this.height=n,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.context=this.canvas.getContext("2d"),this.blockWidth=this.width/c,this.blockHeight=this.height/l,this.element.appendChild(this.canvas)}return e(i)(a,[{key:"render",value:function(e){var t=e.playfield;this.clearScreen(),this.renderPlayfield(t)}},{key:"clearScreen",value:function(){this.context.clearRect(0,0,this.width,this.height)}},{key:"renderPlayfield",value:function(e){for(var t=0;t<e.length;t++)for(var i=e[t],r=0;r<i.length;r++){var n=i[r];n&&this.renderBlock(r*this.blockWidth,t*this.blockHeight,this.blockWidth,this.blockHeight,a.colors[n])}}},{key:"renderBlock",value:function(e,t,i,a,r){this.context.fillStyle=r,this.context.strokeStyle="black",this.context.lineWidth=2,this.context.fillRect(e,t,i,a),this.context.strokeRect(e,t,i,a)}}]),a}();e(r)(l,"colors",{1:"cyan",2:"blue",3:"orange",4:"yellow",5:"green",6:"purple",7:"red"});var c=document.querySelector("#root"),o=new n,s=new l(c,320,640,20,10);window.game=o,window.view=s,document.addEventListener("keydown",(function(e){switch(e.keyCode){case 37:o.movePieceLeft(),s.render(o.getState());break;case 38:o.rotatePiece(),s.render(o.getState());break;case 39:o.movePieceRight(),s.render(o.getState());break;case 40:o.movePieceDown(),s.render(o.getState())}}))}();
//# sourceMappingURL=index.9e2220af.js.map
