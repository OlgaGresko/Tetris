function t(t){return t&&t.__esModule?t.default:t}var e={};Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,i){e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i;return t};class i{get level(){return Math.floor(.1*this.lines)}getState(){const t=this.createPlayfield(),{y:e,x:i,blocks:s}=this.activePiece;for(let e=0;e<this.playfield.length;e++){t[e]=[];for(let i=0;i<this.playfield[e].length;i++)t[e][i]=this.playfield[e][i]}for(let h=0;h<s.length;h++)for(let l=0;l<s[h].length;l++)s[h][l]&&(t[e+h][i+l]=s[h][l]);return{score:this.score,level:this.level,lines:this.lines,nextPiece:this.nextPiece,playfield:t,isGameOver:this.topOut}}reset(){this.score=0,this.lines=0,this.topOut=!1,this.playfield=this.createPlayfield(),this.activePiece=this.createPiece(),this.nextPiece=this.createPiece()}createPlayfield(){const t=[];for(let e=0;e<20;e++){t[e]=[];for(let i=0;i<10;i++)t[e][i]=0}return t}createPiece(){const t={};switch("IJLOSTZ"[Math.floor(7*Math.random())]){case"I":t.blocks=[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]];break;case"J":t.blocks=[[0,0,0],[2,2,2],[0,0,2]];break;case"L":t.blocks=[[0,0,0],[3,3,3],[3,0,0]];break;case"O":t.blocks=[[0,0,0,0],[0,4,4,0],[0,4,4,0],[0,0,0,0]];break;case"S":t.blocks=[[0,0,0],[0,5,5],[5,5,0]];break;case"T":t.blocks=[[0,0,0],[6,6,6],[0,6,0]];break;case"Z":t.blocks=[[0,0,0],[7,7,0],[0,7,7]];break;default:throw new Error("Unknown type of figure")}return t.x=Math.floor((10-t.blocks[0].length)/2),t.y=-1,t}movePieceLeft(){this.activePiece.x-=1,this.hasCollision()&&(this.activePiece.x+=1)}movePieceRight(){this.activePiece.x+=1,this.hasCollision()&&(this.activePiece.x-=1)}movePieceDown(){if(!this.topOut){if(this.activePiece.y+=1,this.hasCollision()){this.activePiece.y-=1,this.lockPiece();const t=this.clearLines();this.updateScore(t),this.updatePieces()}this.hasCollision()&&(this.topOut=!0)}}rotatePiece(){this.rotateBlocks(),this.hasCollision()&&this.rotateBlocks(!1)}rotateBlocks(t=!0){const e=this.activePiece.blocks,i=e.length,s=Math.floor(i/2),h=i-1;for(let i=0;i<s;i++)for(let s=i;s<h-i;s++){const l=e[i][s];t?(e[i][s]=e[h-s][i],e[h-s][i]=e[h-i][h-s],e[h-i][h-s]=e[s][h-i],e[s][h-i]=l):(e[i][s]=e[s][h-i],e[s][h-i]=e[h-i][h-s],e[h-i][h-s]=e[h-s][i],e[h-s][i]=l)}}hasCollision(){const{y:t,x:e,blocks:i}=this.activePiece;for(let s=0;s<i.length;s++)for(let h=0;h<i.length;h++)if(i[s][h]&&(void 0===this.playfield[t+s]||void 0===this.playfield[t+s][e+h]||this.playfield[t+s][e+h]))return!0;return!1}lockPiece(){const{y:t,x:e,blocks:i}=this.activePiece;for(let s=0;s<i.length;s++)for(let h=0;h<i.length;h++)i[s][h]&&(this.playfield[t+s][e+h]=i[s][h])}clearLines(){let t=[];for(let e=19;e>0;e--){let i=0;for(let t=0;t<10;t++)this.playfield[e][t]&&(i+=1);if(0===i)break;i<10||10===i&&t.unshift(e)}for(let e of t)this.playfield.splice(e,1),this.playfield.unshift(new Array(10).fill(0));return t.length}updateScore(t){t>0&&(this.score+=i.points[t]*(this.level+1),this.lines+=t)}updatePieces(){this.activePiece=this.nextPiece,this.nextPiece=this.createPiece()}constructor(){this.reset()}}t(e)(i,"points",{1:40,2:100,3:300,4:1200});class s{renderMainScreen(t){this.clearScreen(),this.renderPlayfield(t),this.renderPanel(t)}renderStartScreen(){this.context.fillStyle="white",this.context.font='18px "Press Start 2P"',this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillText("Press ENTER to Start",this.width/2,this.height/2)}renderPauseScreen(){this.context.fillStyle="rgba(0,0,0,0.75)",this.context.fillRect(0,0,this.width,this.height),this.context.fillStyle="white",this.context.font='18px "Press Start 2P"',this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillText("Press ENTER to Resume",this.width/2,this.height/2)}renderEndScreen({score:t}){this.clearScreen(),this.context.fillStyle="white",this.context.font='18px "Press Start 2P"',this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillText("GAME OVER",this.width/2,this.height/2-48),this.context.fillText(`Score: ${t}`,this.width/2,this.height/2),this.context.fillText("Press ENTER to Restart",this.width/2,this.height/2+48)}clearScreen(){this.context.clearRect(0,0,this.width,this.height)}renderPlayfield({playfield:t}){for(let e=0;e<t.length;e++){const i=t[e];for(let t=0;t<i.length;t++){const h=i[t];h&&this.renderBlock(this.playfieldX+t*this.blockWidth,this.playfieldY+e*this.blockHeight,this.blockWidth,this.blockHeight,s.colors[h])}}this.context.strokeStyle="white",this.context.lineWidth=this.playfieldBorderWidth,this.context.strokeRect(0,0,this.playfieldWidth,this.playfieldHeight)}renderPanel({level:t,score:e,lines:i,nextPiece:h}){this.context.textAlign="start",this.context.textBaseline="top",this.context.fillStyle="white",this.context.font='14px "Press Start 2P"',this.context.fillText(`Score: ${e}`,this.panelX,this.panelY+0),this.context.fillText(`Lines: ${i}`,this.panelX,this.panelY+24),this.context.fillText(`Level: ${t}`,this.panelX,this.panelY+48),this.context.fillText("Next:",this.panelX,this.panelY+96);for(let t=0;t<h.blocks.length;t++)for(let e=0;e<h.blocks[t].length;e++){const i=h.blocks[t][e];i&&this.renderBlock(this.panelX+e*this.blockWidth*.5,this.panelY+100+t*this.blockHeight*.5,.5*this.blockWidth,.5*this.blockHeight,s.colors[i])}}renderBlock(t,e,i,s,h){this.context.fillStyle=h,this.context.strokeStyle="black",this.context.lineWidth=2,this.context.fillRect(t,e,i,s),this.context.strokeRect(t,e,i,s)}constructor(t,e,i,s,h){this.element=t,this.width=e,this.height=i,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.context=this.canvas.getContext("2d"),this.playfieldBorderWidth=4,this.playfieldX=this.playfieldBorderWidth,this.playfieldY=this.playfieldBorderWidth,this.playfieldWidth=2*this.width/3,this.playfieldHeight=this.height,this.playfieldInnerWidth=this.playfieldWidth-2*this.playfieldBorderWidth,this.playfieldInnerHeight=this.playfieldHeight-2*this.playfieldBorderWidth,this.blockWidth=this.playfieldInnerWidth/h,this.blockHeight=this.playfieldInnerHeight/s,this.panelX=this.playfieldWidth+10,this.panelY=0,this.panelWidth=this.width/3,this.panelHeight=this.height,this.element.appendChild(this.canvas)}}t(e)(s,"colors",{1:"cyan",2:"blue",3:"orange",4:"yellow",5:"green",6:"purple",7:"red"});const h=document.querySelector("#root"),l=new i,n=new s(h,480,640,20,10),r=new class{update(){this.game.movePieceDown(),this.updateView()}play(){this.isPlaying=!0,this.startTimer(),this.updateView()}pause(){this.isPlaying=!1,this.stopTimer(),this.updateView()}reset(){this.game.reset(),this.stopTimer(),this.play()}updateView(){const t=this.game.getState();t.isGameOver?this.view.renderEndScreen(t):this.isPlaying?this.view.renderMainScreen(this.game.getState()):this.view.renderPauseScreen()}startTimer(){const t=1e3-100*this.game.getState().level;this.intervalId||(this.intervalId=setInterval((()=>{this.update()}),t>0?t:100))}stopTimer(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}handleKeyDown(t){const e=this.game.getState();switch(t.key){case"Enter":e.isGameOver?this.reset():this.isPlaying?this.pause():this.play();break;case"ArrowLeft":this.isPlaying&&(this.game.movePieceLeft(),this.updateView());break;case"ArrowUp":this.isPlaying&&(this.game.rotatePiece(),this.updateView());break;case"ArrowRight":this.isPlaying&&(this.game.movePieceRight(),this.updateView());break;case"ArrowDown":this.isPlaying&&(this.stopTimer(),this.game.movePieceDown(),this.updateView())}}handleKeyUp(t){if("ArrowDown"===t.key)this.startTimer()}constructor(t,e){this.game=t,this.view=e,this.intervalId=null,this.isPlaying=!1,document.addEventListener("keydown",this.handleKeyDown.bind(this)),document.addEventListener("keyup",this.handleKeyUp.bind(this)),this.view.renderStartScreen()}}(l,n);window.game=l,window.view=n,window.controller=r;
//# sourceMappingURL=index.e0425d6f.js.map
