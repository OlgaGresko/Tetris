{"mappings":"0DACAA,OAAOC,eAAeC,EAAS,aAAc,CACzCC,OAAO,IAEXD,EAAQE,QACR,SAAyBC,EAAKC,EAAKH,GAC3BG,KAAOD,EACPL,OAAOC,eAAeI,EAAKC,EAAK,CAC5BH,MAAOA,EACPI,YAAY,EACZC,cAAc,EACdC,UAAU,IAGdJ,EAAIC,GAAOH,EAEf,OAAOE,C,EChBI,MAAMK,EA2BnBC,QAAOC,UAAEA,IACPC,KAAKC,cACLD,KAAKE,gBAAgBH,E,CAGvBE,cACED,KAAKG,QAAQC,UAAU,EAAG,EAAGJ,KAAKK,MAAOL,KAAKM,O,CAGhDJ,gBAAgBH,GACd,IAAK,IAAIQ,EAAI,EAAGA,EAAIR,EAAUS,OAAQD,IAAK,CACzC,MAAME,EAAOV,EAAUQ,GAEvB,IAAK,IAAIG,EAAI,EAAGA,EAAID,EAAKD,OAAQE,IAAK,CACpC,MAAMC,EAAQF,EAAKC,GAEfC,GACFX,KAAKY,YACHF,EAAIV,KAAKa,WACTN,EAAIP,KAAKc,YACTd,KAAKa,WACLb,KAAKc,YACLjB,EAAKkB,OAAOJ,G,GAOtBC,YAAYF,EAAGH,EAAGF,EAAOC,EAAQU,GAC/BhB,KAAKG,QAAQc,UAAYD,EACzBhB,KAAKG,QAAQe,YAAc,QAC3BlB,KAAKG,QAAQgB,UAAY,EAEzBnB,KAAKG,QAAQiB,SAASV,EAAGH,EAAGF,EAAOC,GACnCN,KAAKG,QAAQkB,WAAWX,EAAGH,EAAGF,EAAOC,E,CAnDvCgB,YAAYC,EAASlB,EAAOC,EAAQkB,EAAMC,GACxCzB,KAAKuB,QAAUA,EACfvB,KAAKK,MAAQA,EACbL,KAAKM,OAASA,EAEdN,KAAK0B,OAASC,SAASC,cAAc,UACrC5B,KAAK0B,OAAOrB,MAAQL,KAAKK,MACzBL,KAAK0B,OAAOpB,OAASN,KAAKM,OAC1BN,KAAKG,QAAUH,KAAK0B,OAAOG,WAAW,MAEtC7B,KAAKa,WAAab,KAAKK,MAAQoB,EAC/BzB,KAAKc,YAAcd,KAAKM,OAASkB,EAEjCxB,KAAKuB,QAAQO,YAAY9B,KAAK0B,O,EAvBhCK,EAAA1C,EAAA,CADmBQ,EACZ,SAAS,CACd,EAAK,OACL,EAAK,OACL,EAAK,SACL,EAAK,SACL,EAAK,QACL,EAAK,SACL,EAAK,QCLT,MAAMmC,EAAOL,SAASM,cAAc,SAE9BC,EAAO,ICLE,MAQbC,WACE,MAAMpC,EAAYC,KAAKoC,mBACf7B,EAAG8B,EAAQ3B,EAAG4B,EAAMC,OAAEA,GAAWvC,KAAKwC,YAE9C,IAAK,IAAIjC,EAAI,EAAGA,EAAIP,KAAKD,UAAUS,OAAQD,IAAK,CAC9CR,EAAUQ,GAAK,GAEf,IAAK,IAAIG,EAAI,EAAGA,EAAIV,KAAKD,UAAUQ,GAAGC,OAAQE,IAC5CX,EAAUQ,GAAGG,GAAKV,KAAKD,UAAUQ,GAAGG,E,CAIxC,IAAK,IAAI+B,EAAI,EAAGA,EAAIF,EAAO/B,OAAQiC,IACjC,IAAK,IAAI/B,EAAI,EAAGA,EAAI6B,EAAOE,GAAGjC,OAAQE,IAChC6B,EAAOE,GAAG/B,KACZX,EAAUsC,EAASI,GAAGH,EAAS5B,GAAK6B,EAAOE,GAAG/B,IAKpD,MAAO,C,UACLX,E,CAIJqC,kBACE,MAAMrC,EAAY,GAElB,IAAK,IAAIQ,EAAI,EAAGA,EAAI,GAAIA,IAAK,CAC3BR,EAAUQ,GAAK,GAEf,IAAK,IAAIG,EAAI,EAAGA,EAAI,GAAIA,IACtBX,EAAUQ,GAAGG,GAAK,C,CAItB,OAAOX,C,CAGT2C,cACE,MAEMC,EAAQ,GAEd,OAHa,UADCC,KAAKC,MAAsB,EAAhBD,KAAKE,YAK5B,IAAK,IACHH,EAAMJ,OAAS,CACb,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,IAEZ,MACF,IAAK,IACHI,EAAMJ,OAAS,CACb,CAAC,EAAG,EAAG,GACP,CAAC,EAAG,EAAG,GACP,CAAC,EAAG,EAAG,IAET,MACF,IAAK,IACHI,EAAMJ,OAAS,CACb,CAAC,EAAG,EAAG,GACP,CAAC,EAAG,EAAG,GACP,CAAC,EAAG,EAAG,IAET,MACF,IAAK,IACHI,EAAMJ,OAAS,CACb,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,IAEZ,MACF,IAAK,IACHI,EAAMJ,OAAS,CACb,CAAC,EAAG,EAAG,GACP,CAAC,EAAG,EAAG,GACP,CAAC,EAAG,EAAG,IAET,MACF,IAAK,IACHI,EAAMJ,OAAS,CACb,CAAC,EAAG,EAAG,GACP,CAAC,EAAG,EAAG,GACP,CAAC,EAAG,EAAG,IAET,MACF,IAAK,IACHI,EAAMJ,OAAS,CACb,CAAC,EAAG,EAAG,GACP,CAAC,EAAG,EAAG,GACP,CAAC,EAAG,EAAG,IAET,MACF,QACE,MAAM,IAAIQ,MAAM,0BAMpB,OAHAJ,EAAMjC,EAAIkC,KAAKC,OAAO,GAAKF,EAAMJ,OAAO,GAAG/B,QAAU,GACrDmC,EAAMpC,EAAI,EAEHoC,C,CAGTK,gBACEhD,KAAKwC,YAAY9B,GAAK,EAElBV,KAAKiD,iBACPjD,KAAKwC,YAAY9B,GAAK,E,CAI1BwC,iBACElD,KAAKwC,YAAY9B,GAAK,EAElBV,KAAKiD,iBACPjD,KAAKwC,YAAY9B,GAAK,E,CAI1ByC,gBACEnD,KAAKwC,YAAYjC,GAAK,EAElBP,KAAKiD,iBACPjD,KAAKwC,YAAYjC,GAAK,EACtBP,KAAKoD,YACLpD,KAAKqD,e,CAITC,cACEtD,KAAKuD,eAEDvD,KAAKiD,gBACPjD,KAAKuD,cAAa,E,CAItBA,aAAaC,GAAY,GACvB,MAAMjB,EAASvC,KAAKwC,YAAYD,OAC1B/B,EAAS+B,EAAO/B,OAChBE,EAAIkC,KAAKC,MAAMrC,EAAS,GACxBD,EAAIC,EAAS,EAEnB,IAAK,IAAIiD,EAAI,EAAGA,EAAI/C,EAAG+C,IACrB,IAAK,IAAIC,EAAID,EAAGC,EAAInD,EAAIkD,EAAGC,IAAK,CAC9B,MAAMC,EAAOpB,EAAOkB,GAAGC,GAEnBF,GACFjB,EAAOkB,GAAGC,GAAKnB,EAAOhC,EAAImD,GAAGD,GAC7BlB,EAAOhC,EAAImD,GAAGD,GAAKlB,EAAOhC,EAAIkD,GAAGlD,EAAImD,GACrCnB,EAAOhC,EAAIkD,GAAGlD,EAAImD,GAAKnB,EAAOmB,GAAGnD,EAAIkD,GACrClB,EAAOmB,GAAGnD,EAAIkD,GAAKE,IAEnBpB,EAAOkB,GAAGC,GAAKnB,EAAOmB,GAAGnD,EAAIkD,GAC7BlB,EAAOmB,GAAGnD,EAAIkD,GAAKlB,EAAOhC,EAAIkD,GAAGlD,EAAImD,GACrCnB,EAAOhC,EAAIkD,GAAGlD,EAAImD,GAAKnB,EAAOhC,EAAImD,GAAGD,GACrClB,EAAOhC,EAAImD,GAAGD,GAAKE,E,EAM3BV,eACE,MAAQ1C,EAAG8B,EAAQ3B,EAAG4B,EAAMC,OAAEA,GAAWvC,KAAKwC,YAE9C,IAAK,IAAIjC,EAAI,EAAGA,EAAIgC,EAAO/B,OAAQD,IACjC,IAAK,IAAIG,EAAI,EAAGA,EAAI6B,EAAO/B,OAAQE,IACjC,GACE6B,EAAOhC,GAAGG,UACsBkD,IAA/B5D,KAAKD,UAAUsC,EAAS9B,SACoBqD,IAA3C5D,KAAKD,UAAUsC,EAAS9B,GAAG+B,EAAS5B,IACpCV,KAAKD,UAAUsC,EAAS9B,GAAG+B,EAAS5B,IAEtC,OAAO,EAIb,OAAO,C,CAGT0C,YACE,MAAQ7C,EAAG8B,EAAQ3B,EAAG4B,EAAMC,OAAEA,GAAWvC,KAAKwC,YAE9C,IAAK,IAAIjC,EAAI,EAAGA,EAAIgC,EAAO/B,OAAQD,IACjC,IAAK,IAAIG,EAAI,EAAGA,EAAI6B,EAAO/B,OAAQE,IAC7B6B,EAAOhC,GAAGG,KACZV,KAAKD,UAAUsC,EAAS9B,GAAG+B,EAAS5B,GAAK6B,EAAOhC,GAAGG,G,CAM3D2C,eACErD,KAAKwC,YAAcxC,KAAK6D,UACxB7D,KAAK6D,UAAY7D,KAAK0C,a,eA5MxBX,EAAA1C,EAAA,CAAAW,KAAA,QAAQ,GACR+B,EAAA1C,EAAA,CAAAW,KAAA,QAAQ,GACR+B,EAAA1C,EAAA,CAAAW,KAAA,QAAQ,GACR+B,EAAA1C,EAAA,CAAAW,KAAA,YAAYA,KAAKoC,mBACjBL,EAAA1C,EAAA,CAAAW,KAAA,cAAcA,KAAK0C,eACnBX,EAAA1C,EAAA,CAAAW,KAAA,YAAYA,KAAK0C,c,GDAboB,EAAO,IAAIjE,EAAKmC,EAAM,IAAK,IAAK,GAAI,IAE1C+B,OAAOC,KAAO9B,EACd6B,OAAOE,KAAOH,EAEdnC,SAASuC,iBAAiB,WAAWC,IACjC,OAAQA,EAAMC,SACV,KAAK,GACDlC,EAAKc,gBACLc,EAAKhE,OAAOoC,EAAKC,YACjB,MACJ,KAAK,GACDD,EAAKoB,cACLQ,EAAKhE,OAAOoC,EAAKC,YACjB,MACJ,KAAK,GACDD,EAAKgB,iBACLY,EAAKhE,OAAOoC,EAAKC,YACjB,MACJ,KAAK,GACDD,EAAKiB,gBACLW,EAAKhE,OAAOoC,EAAKC,Y","sources":["node_modules/@swc/helpers/lib/_define_property.js","src/view.js","src/index.js","src/game.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.default = _defineProperty;\nfunction _defineProperty(obj, key, value) {\n    if (key in obj) {\n        Object.defineProperty(obj, key, {\n            value: value,\n            enumerable: true,\n            configurable: true,\n            writable: true\n        });\n    } else {\n        obj[key] = value;\n    }\n    return obj;\n}\n","export default class View {\n  static colors = {\n    '1': 'cyan',\n    '2': 'blue',\n    '3': 'orange',\n    '4': 'yellow',\n    '5': 'green',\n    '6': 'purple',\n    '7': 'red'\n  }  \n\n  constructor(element, width, height, rows, columns) {\n    this.element = element;\n    this.width = width;\n    this.height = height;\n\n    this.canvas = document.createElement('canvas');\n    this.canvas.width = this.width;\n    this.canvas.height = this.height;\n    this.context = this.canvas.getContext('2d');\n\n    this.blockWidth = this.width / columns;\n    this.blockHeight = this.height / rows;\n\n    this.element.appendChild(this.canvas);\n  }\n\n  render({ playfield }) {\n    this.clearScreen();\n    this.renderPlayfield(playfield);\n  }\n\n  clearScreen() {\n    this.context.clearRect(0, 0, this.width, this.height);\n  }\n\n  renderPlayfield(playfield) {\n    for (let y = 0; y < playfield.length; y++) {\n      const line = playfield[y];\n\n      for (let x = 0; x < line.length; x++) {\n        const block = line[x];\n\n        if (block) {\n          this.renderBlock(\n            x * this.blockWidth,\n            y * this.blockHeight,\n            this.blockWidth,\n            this.blockHeight,\n            View.colors[block]\n          );\n        }\n      }\n    }\n  }\n\n  renderBlock(x, y, width, height, color) {\n    this.context.fillStyle = color;\n    this.context.strokeStyle = 'black';\n    this.context.lineWidth = 2;\n\n    this.context.fillRect(x, y, width, height);\n    this.context.strokeRect(x, y, width, height);\n  }\n}\n","import Game from './game';\nimport View from './view';\n\nconst root = document.querySelector('#root');\n\nconst game = new Game();\nconst view = new View(root, 320, 640, 20, 10);\n\nwindow.game = game;\nwindow.view = view;\n\ndocument.addEventListener(\"keydown\", event => {\n    switch (event.keyCode) {\n        case 37: // LEFT ARROW\n            game.movePieceLeft();\n            view.render(game.getState());\n            break;\n        case 38: // UP ARROW\n            game.rotatePiece();\n            view.render(game.getState());\n            break;\n        case 39: // RIGHT ARROW\n            game.movePieceRight();\n            view.render(game.getState());\n            break;\n        case 40: // DOWN ARROW\n            game.movePieceDown();\n            view.render(game.getState());\n            break;\n    }\n})\n\n","export default class Game {\n  score = 0;\n  lines = 0;\n  level = 0;\n  playfield = this.createPlayfield();\n  activePiece = this.createPiece();\n  nextPiece = this.createPiece();\n\n  getState() {\n    const playfield = this.createPlayfield();\n    const { y: pieceY, x: pieceX, blocks } = this.activePiece;\n\n    for (let y = 0; y < this.playfield.length; y++) {\n      playfield[y] = [];\n\n      for (let x = 0; x < this.playfield[y].length; x++) {\n        playfield[y][x] = this.playfield[y][x];\n      }\n    }\n\n    for (let y = 0; y < blocks.length; y++) {\n      for (let x = 0; x < blocks[y].length; x++) {\n        if (blocks[y][x]) {\n          playfield[pieceY + y][pieceX + x] = blocks[y][x];\n        }\n      }\n    }\n\n    return {\n      playfield,\n    };\n  }\n\n  createPlayfield() {\n    const playfield = [];\n\n    for (let y = 0; y < 20; y++) {\n      playfield[y] = [];\n\n      for (let x = 0; x < 10; x++) {\n        playfield[y][x] = 0;\n      }\n    }\n\n    return playfield;\n  }\n\n  createPiece() {\n    const index = Math.floor(Math.random() * 7);\n    const type = 'IJLOSTZ'[index];\n    const piece = {};\n\n    switch (type) {\n      case 'I':\n        piece.blocks = [\n          [0, 0, 0, 0],\n          [1, 1, 1, 1],\n          [0, 0, 0, 0],\n          [0, 0, 0, 0],\n        ];\n        break;\n      case 'J':\n        piece.blocks = [\n          [0, 0, 0],\n          [2, 2, 2],\n          [0, 0, 2],\n        ];\n        break;\n      case 'L':\n        piece.blocks = [\n          [0, 0, 0],\n          [3, 3, 3],\n          [3, 0, 0]\n        ];\n        break;\n      case 'O':\n        piece.blocks = [\n          [0, 0, 0, 0],\n          [0, 4, 4, 0],\n          [0, 4, 4, 0],\n          [0, 0, 0, 0]\n        ];\n        break;\n      case 'S':\n        piece.blocks = [\n          [0, 0, 0],\n          [0, 5, 5],\n          [5, 5, 0]\n        ];\n        break;\n      case 'T':\n        piece.blocks = [\n          [0, 0, 0],\n          [6, 6, 6],\n          [0, 6, 0]\n        ];\n        break;\n      case 'Z':\n        piece.blocks = [\n          [0, 0, 0],\n          [7, 7, 0],\n          [0, 7, 7]\n        ];\n        break;\n      default:\n        throw new Error('Unknown type of figure');\n    };\n\n    piece.x = Math.floor((10 - piece.blocks[0].length) / 2);\n    piece.y = 0;\n\n    return piece;\n  }\n\n  movePieceLeft() {\n    this.activePiece.x -= 1;\n\n    if (this.hasCollision()) {\n      this.activePiece.x += 1;\n    }\n  }\n\n  movePieceRight() {\n    this.activePiece.x += 1;\n\n    if (this.hasCollision()) {\n      this.activePiece.x -= 1;\n    }\n  }\n\n  movePieceDown() {\n    this.activePiece.y += 1;\n\n    if (this.hasCollision()) {\n      this.activePiece.y -= 1;\n      this.lockPiece();\n      this.updatePieces();\n    }\n  }\n\n  rotatePiece() {\n    this.rotateBlocks();\n\n    if (this.hasCollision()) {\n      this.rotateBlocks(false);\n    }\n  }\n\n  rotateBlocks(clockwise = true) {\n    const blocks = this.activePiece.blocks;\n    const length = blocks.length;\n    const x = Math.floor(length / 2);\n    const y = length - 1;\n\n    for (let i = 0; i < x; i++) {\n      for (let j = i; j < y - i; j++) {\n        const temp = blocks[i][j];\n\n        if (clockwise) {\n          blocks[i][j] = blocks[y - j][i];\n          blocks[y - j][i] = blocks[y - i][y - j];\n          blocks[y - i][y - j] = blocks[j][y - i];\n          blocks[j][y - i] = temp;\n        } else {\n          blocks[i][j] = blocks[j][y - i];\n          blocks[j][y - i] = blocks[y - i][y - j];\n          blocks[y - i][y - j] = blocks[y - j][i];\n          blocks[y - j][i] = temp;\n        }\n      }\n    }\n  }\n\n  hasCollision() {\n    const { y: pieceY, x: pieceX, blocks } = this.activePiece;\n\n    for (let y = 0; y < blocks.length; y++) {\n      for (let x = 0; x < blocks.length; x++) {\n        if (\n          blocks[y][x] &&\n          (this.playfield[pieceY + y] === undefined ||\n            this.playfield[pieceY + y][pieceX + x] === undefined ||\n            this.playfield[pieceY + y][pieceX + x])\n        ) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  lockPiece() {\n    const { y: pieceY, x: pieceX, blocks } = this.activePiece;\n\n    for (let y = 0; y < blocks.length; y++) {\n      for (let x = 0; x < blocks.length; x++) {\n        if (blocks[y][x]) {\n          this.playfield[pieceY + y][pieceX + x] = blocks[y][x];\n        }\n      }\n    }\n  }\n\n  updatePieces() {\n    this.activePiece = this.nextPiece;\n    this.nextPiece = this.createPiece();\n  }\n}\n"],"names":["Object","defineProperty","$da4b248c00322402$exports","value","default","obj","key","enumerable","configurable","writable","$159cd715dad6a107$export$2e2bcd8739ae039","render","playfield","this","clearScreen","renderPlayfield","context","clearRect","width","height","y","length","line","x","block","renderBlock","blockWidth","blockHeight","colors","color","fillStyle","strokeStyle","lineWidth","fillRect","strokeRect","constructor","element","rows","columns","canvas","document","createElement","getContext","appendChild","$parcel$interopDefault","$1f0dc3b9307be026$var$root","querySelector","$1f0dc3b9307be026$var$game","getState","createPlayfield","pieceY","pieceX","blocks","activePiece","y1","createPiece","piece","Math","floor","random","Error","movePieceLeft","hasCollision","movePieceRight","movePieceDown","lockPiece","updatePieces","rotatePiece","rotateBlocks","clockwise","i","j","temp","undefined","nextPiece","$1f0dc3b9307be026$var$view","window","game","view","addEventListener","event","keyCode"],"version":3,"file":"index.be22c654.js.map"}